<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Testing Methodologies - Rendezvous: The Clarity Fuzzer</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rendezvous: The Clarity Fuzzer</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/stacks-network/rendezvous/tree/master/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/stacks-network/rendezvous/blob/master/docs/./chapter_4.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="testing-methodologies"><a class="header" href="#testing-methodologies">Testing Methodologies</a></h1>
<p>Rendezvous offers two complementary testing methodologies: property-based testing and invariant testing. This chapter explains both approaches and when to use each.</p>
<h2 id="property-based-testing-vs-invariant-testing"><a class="header" href="#property-based-testing-vs-invariant-testing">Property-Based Testing vs. Invariant Testing</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Property-Based Testing</th><th>Invariant Testing</th></tr></thead><tbody>
<tr><td>Tests individual functions</td><td>Tests system-wide properties</td></tr>
<tr><td>Generates random inputs for specific functions</td><td>Generates random sequences of function calls</td></tr>
<tr><td>Verifies function behavior is correct for all inputs</td><td>Verifies state remains valid after any operation sequence</td></tr>
<tr><td>Helps find edge cases in specific functions</td><td>Helps find unexpected interactions between functions</td></tr>
</tbody></table>
</div>
<h2 id="understanding-property-based-testing"><a class="header" href="#understanding-property-based-testing">Understanding Property-Based Testing</a></h2>
<blockquote>
<p>Property-based testing verifies that specific properties of your code hold true across a wide range of inputs. Instead of manually crafting test cases, you define a property, and Rendezvous automatically generates test inputs.</p>
</blockquote>
<h3 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h3>
<ul>
<li><strong>Properties</strong>: Universal truths about your functions (e.g., "reversing a list twice returns the original list")</li>
<li><strong>Generators</strong>: Automatic creation of random test inputs based on function signatures<sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup></li>
<li><strong>Shrinking</strong>: Finding the simplest failing input for easier debugging</li>
<li><strong>Discarding</strong>: Skipping invalid inputs to focus on meaningful test scenarios</li>
</ul>
<p><strong>Best For</strong>: Functions that don't modify state (read-only), operations with mathematical properties, functions with well-defined behaviors across varied inputs</p>
<h3 id="example-property-based-test"><a class="header" href="#example-property-based-test">Example Property-Based Test</a></h3>
<p>Here's a simple example of a property-based test that verifies the "reversing a list twice returns the original list" property:</p>
<pre><code class="language-clarity">(define-public (test-reverse-uint (seq (list 127 uint)))
  (begin
    (asserts!
      (is-eq seq (reverse-uint (reverse-uint seq)))
      ERR_ASSERTION_FAILED
    )
    (ok true)
  )
)
</code></pre>
<p>This test demonstrates the key conventions for property-based tests in Rendezvous:</p>
<ul>
<li>Function name starts with <code>test-</code></li>
<li>Function is declared as <code>public</code></li>
<li>Test passes when it returns <code>(ok true)</code></li>
<li>Test would be discarded if it returned <code>(ok false)</code></li>
<li>Test fails if it returns an error or throws an exception</li>
</ul>
<p>In this example, <code>seq</code> is automatically generated by Rendezvous with different random values for each test run. The property being tested is that applying <code>reverse-uint</code> twice to any list should return the original list.</p>
<h2 id="understanding-invariant-testing"><a class="header" href="#understanding-invariant-testing">Understanding Invariant Testing</a></h2>
<blockquote>
<p>Invariant testing ensures that certain conditions about your contract's state remain true regardless of which operations are performed in which order.</p>
</blockquote>
<h3 id="key-concepts-1"><a class="header" href="#key-concepts-1">Key Concepts</a></h3>
<ul>
<li><strong>Invariants</strong>: Conditions that must always hold true about your contract's state</li>
<li><strong>State transitions</strong>: Changes triggered by function calls</li>
<li><strong>Function sequences</strong>: Random series of operations to test state consistency</li>
<li><strong>Context tracking</strong>: Recording function call history to enable sophisticated checks</li>
</ul>
<p><strong>Best For</strong>: State management, complex transitions, maintaining relationships between variables, ensuring safety properties</p>
<h3 id="example-invariant-test"><a class="header" href="#example-invariant-test">Example Invariant Test</a></h3>
<p>Here's an example of an invariant test that ensures a counter remains positive when increments exceed decrements:</p>
<pre><code class="language-clarity">(define-read-only (invariant-counter-gt-zero)
  (let
    (
      (increment-num-calls
        (default-to u0 (get called (map-get? context "increment")))
      )
      (decrement-num-calls
        (default-to u0 (get called (map-get? context "decrement")))
      )
    )
    (if
      (&lt;= increment-num-calls decrement-num-calls)
      true
      (&gt; (var-get counter) u0)
    )
  )
)
</code></pre>
<p>This test demonstrates the key conventions for invariant tests in Rendezvous:</p>
<ul>
<li>Function name starts with <code>invariant-</code></li>
<li>Function is declared as <code>read-only</code> (not public)</li>
<li>Function returns a boolean value (true if the invariant holds, false if violated)</li>
<li>The test can use the special <code>context</code> map to access execution history</li>
</ul>
<p>In this example, the invariant verifies that if increment has been called more times than decrement, the counter should be greater than zero. Rendezvous will randomly call functions in your contract and check this invariant between calls to ensure the contract's state remains valid regardless of the sequence of operations.</p>
<h2 id="testing-from-inside-vs-outside"><a class="header" href="#testing-from-inside-vs-outside">Testing from Inside vs. Outside</a></h2>
<h3 id="testing-from-inside"><a class="header" href="#testing-from-inside">Testing from Inside</a></h3>
<p>Writing tests in Clarity alongside your contract code provides:</p>
<ul>
<li>Direct access to internal state and private functions</li>
<li>Natural expression of contract properties in the same language</li>
</ul>
<h3 id="testing-from-outside"><a class="header" href="#testing-from-outside">Testing from Outside</a></h3>
<p>Using external tools (like TypeScript libraries) enables:</p>
<ul>
<li>Testing integration between multiple contracts</li>
<li>Examining transaction-level concerns like events</li>
<li>Using pre- and post-execution functions (see Dialers, Chapter 6)</li>
</ul>
<h2 id="practical-testing-strategy"><a class="header" href="#practical-testing-strategy">Practical Testing Strategy</a></h2>
<p>For most contracts, a combined approach yields the best results:</p>
<ol>
<li>
<p>Use <strong>property-based tests</strong> for:</p>
<ul>
<li>Pure functions (read-only operations)</li>
<li>Functions with mathematical properties</li>
<li>Validating behavior across many input variations</li>
</ul>
</li>
<li>
<p>Use <strong>invariant tests</strong> for:</p>
<ul>
<li>Verifying state consistency</li>
<li>Testing relationships between state variables</li>
<li>Ensuring contracts can't enter invalid states</li>
</ul>
</li>
<li>
<p>Consider <strong>external testing</strong> when you need to:</p>
<ul>
<li>Verify event emissions</li>
<li>Test interactions across multiple contracts</li>
<li>Use pre/post-execution hooks via dialers</li>
</ul>
</li>
</ol>
<p>By choosing the right testing approach for each aspect of your contract, you can build a comprehensive test suite that ensures correctness under all conditions.</p>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>Rendezvous currently uses a probabilistic approach to automatically generate inputs based on function signatures. In future versions, there may be support for fine-grained control over the scope of these inputs (which would also relate to the shrinking process). Additionally, if symbolic execution capabilities become available for the Clarity VM, Rendezvous could potentially support formal verification techniques that would exhaustively check all possible execution paths rather than using random sampling. <a href="#fr-1-1">↩</a></p>
</li>
</ol>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="chapter_3.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="chapter_5.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="chapter_3.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="chapter_5.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
